---

title: Title

keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 05_sequence.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">mpanim</span>
<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">baseline_3d_pose.utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">baseline_3d_pose.model</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">baseline_3d_pose.viz</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Options</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
        
        <span class="c1"># train options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="s1">&#39;All&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attempt_id</span> <span class="o">=</span> <span class="s1">&#39;01&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attempt_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">attempt_id</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">load_ckpt</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># train hyper-params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bs</span> <span class="o">=</span> <span class="mi">128</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="mf">1e-3</span>
        
        <span class="c1"># model hyper-params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stages</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Path</span><span class="o">.</span><span class="n">ls</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stat_3d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;stat_3d.pt&#39;</span><span class="p">)</span>
<span class="n">stat_2d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;stat_2d.pt&#39;</span><span class="p">)</span>
<span class="n">train_set_2d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;train_2d.pt&#39;</span><span class="p">)</span>
<span class="n">rcams</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;rcams.pt&#39;</span><span class="p">)</span>
<span class="n">mean_2d</span> <span class="o">=</span> <span class="n">stat_2d</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
<span class="n">std_2d</span> <span class="o">=</span> <span class="n">stat_2d</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
<span class="n">dim_use_2d</span> <span class="o">=</span> <span class="n">stat_2d</span><span class="p">[</span><span class="s1">&#39;dim_use&#39;</span><span class="p">]</span>
<span class="n">dim_ignore_2d</span> <span class="o">=</span> <span class="n">stat_2d</span><span class="p">[</span><span class="s1">&#39;dim_ignore&#39;</span><span class="p">]</span>
<span class="n">mean_3d</span> <span class="o">=</span> <span class="n">stat_3d</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
<span class="n">std_3d</span> <span class="o">=</span> <span class="n">stat_3d</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
<span class="n">dim_use_3d</span> <span class="o">=</span> <span class="n">stat_3d</span><span class="p">[</span><span class="s1">&#39;dim_use&#39;</span><span class="p">]</span>
<span class="n">dim_ignore_3d</span> <span class="o">=</span> <span class="n">stat_3d</span><span class="p">[</span><span class="s1">&#39;dim_ignore&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imgs_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;imgs&quot;</span><span class="p">)</span>
<span class="n">json_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img_seq</span> <span class="o">=</span> <span class="n">imgs_path</span><span class="o">/</span><span class="s1">&#39;crop_img_seq/&#39;</span>
<span class="n">out_seq</span> <span class="o">=</span> <span class="n">imgs_path</span><span class="o">/</span><span class="s1">&#39;crop_out_seq/&#39;</span>
<span class="n">kp_seq</span> <span class="o">=</span> <span class="n">json_path</span><span class="o">/</span><span class="s1">&#39;crop_json/&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;model/01/options.pt&#39;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">lr</span><span class="p">)</span>

<span class="n">model_state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">attempt_path</span><span class="o">/</span><span class="s1">&#39;last_model.pt&#39;</span><span class="p">)</span>
<span class="n">optimizer_state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">attempt_path</span><span class="o">/</span><span class="s1">&#39;last_optimizer.pt&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
<span class="n">optimizer</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">optimizer_state</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Model(
  (relu): ReLU(inplace=True)
  (drop): Dropout(p=0.5, inplace=False)
  (ln_in): Linear(in_features=32, out_features=1024, bias=True)
  (bn_in): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (lins): ModuleList(
    (0): ResLinear(
      (relu): ReLU(inplace=True)
      (drop): Dropout(p=0.5, inplace=False)
      (ln1): Linear(in_features=1024, out_features=1024, bias=True)
      (bn2): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (ln3): Linear(in_features=1024, out_features=1024, bias=True)
      (bn4): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    )
    (1): ResLinear(
      (relu): ReLU(inplace=True)
      (drop): Dropout(p=0.5, inplace=False)
      (ln1): Linear(in_features=1024, out_features=1024, bias=True)
      (bn2): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (ln3): Linear(in_features=1024, out_features=1024, bias=True)
      (bn4): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    )
  )
  (ln_out): Linear(in_features=1024, out_features=48, bias=True)
)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img_lists</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">img_seq</span><span class="o">.</span><span class="n">ls</span><span class="p">())</span>
<span class="n">out_lists</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">out_seq</span><span class="o">.</span><span class="n">ls</span><span class="p">())</span>
<span class="n">kp_lists</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kp_seq</span><span class="o">.</span><span class="n">ls</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># size = 290</span>
<span class="c1"># for idx, (img, kp) in enumerate(zip(img_lists, kp_lists)):</span>
<span class="c1">#     kl = get_kp_from_json(kp)</span>
<span class="c1">#     kps = coco_to_skel(kl)</span>
<span class="c1">#     hip = (int(kps[0][0]), int(kps[0][1]))</span>
    
<span class="c1">#     inp = cv2.imread(str(img))</span>
<span class="c1">#     inp = cv2.cvtColor(inp, cv2.COLOR_BGR2RGB)</span>
<span class="c1">#     crop = inp[hip[1]-size//2:hip[1]+size//2 , hip[0]-size//2:hip[0]+size//2]</span>
<span class="c1">#     crop = cv2.cvtColor(crop, cv2.COLOR_BGR2RGB)</span>
<span class="c1">#     cv2.imwrite(str(imgs_path/f&#39;crop_img_seq/{idx:05d}.jpg&#39;), crop)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># idx = 39</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">167</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_lists</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">out_lists</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<span class="n">kp</span> <span class="o">=</span> <span class="n">coco_to_skel</span><span class="p">(</span><span class="n">get_kp_from_json</span><span class="p">(</span><span class="n">kp_lists</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kp_norm</span> <span class="o">=</span> <span class="n">normalize_kp</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span> <span class="n">mean_2d</span><span class="p">,</span> <span class="n">std_2d</span><span class="p">,</span> <span class="n">dim_use_2d</span><span class="p">)</span>
<span class="n">kp_unnorm</span> <span class="o">=</span> <span class="n">unnormalize_data</span><span class="p">(</span><span class="n">kp_norm</span><span class="p">,</span> <span class="n">mean_2d</span><span class="p">,</span> <span class="n">std_2d</span><span class="p">,</span> <span class="n">dim_ignore_2d</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">train_set_2d</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">key</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1, &#39;Directions&#39;, &#39;Directions.54138969.h5&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kp_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">kp_norm</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<span class="n">kp_t3d</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">kp_t</span><span class="o">.</span><span class="n">cuda</span><span class="p">())</span>
<span class="n">kp_3d</span> <span class="o">=</span> <span class="n">kp_t3d</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="n">kp_3d</span> <span class="o">=</span> <span class="n">unnormalize_data</span><span class="p">(</span><span class="n">kp_3d</span><span class="p">,</span> <span class="n">mean_3d</span><span class="p">,</span> <span class="n">std_3d</span><span class="p">,</span> <span class="n">dim_ignore_3d</span><span class="p">)</span>
<span class="n">kp_3d</span> <span class="o">=</span> <span class="n">cam_to_world_centered</span><span class="p">(</span><span class="n">kp_3d</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">rcams</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> qt
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">13</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Input Image&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;COCO Pose&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Custom Pose&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;3D Pose Predictions&#39;</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

<span class="n">show_2d_pose</span><span class="p">(</span><span class="n">kp_unnorm</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

<span class="n">show_3d_pose</span><span class="p">(</span><span class="n">kp_3d</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img_ls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">out_ls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">kp_ls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">kp3d_ls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img_lists</span><span class="p">)):</span>
    <span class="n">img_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_lists</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">out_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">out_lists</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    
    <span class="n">kp</span> <span class="o">=</span> <span class="n">coco_to_skel</span><span class="p">(</span><span class="n">get_kp_from_json</span><span class="p">(</span><span class="n">kp_lists</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">kp_norm</span> <span class="o">=</span> <span class="n">normalize_kp</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span> <span class="n">mean_2d</span><span class="p">,</span> <span class="n">std_2d</span><span class="p">,</span> <span class="n">dim_use_2d</span><span class="p">)</span>
    <span class="n">kp_unnorm</span> <span class="o">=</span> <span class="n">unnormalize_data</span><span class="p">(</span><span class="n">kp_norm</span><span class="p">,</span> <span class="n">mean_2d</span><span class="p">,</span> <span class="n">std_2d</span><span class="p">,</span> <span class="n">dim_ignore_2d</span><span class="p">)</span>
    <span class="n">kp_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kp_unnorm</span><span class="p">)</span>
    
    <span class="n">kp_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">kp_norm</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
    <span class="n">kp_t3d</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">kp_t</span><span class="o">.</span><span class="n">cuda</span><span class="p">())</span>
    <span class="n">kp_3d</span> <span class="o">=</span> <span class="n">kp_t3d</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">kp_3d</span> <span class="o">=</span> <span class="n">unnormalize_data</span><span class="p">(</span><span class="n">kp_3d</span><span class="p">,</span> <span class="n">mean_3d</span><span class="p">,</span> <span class="n">std_3d</span><span class="p">,</span> <span class="n">dim_ignore_3d</span><span class="p">)</span>
    <span class="n">kp_3d</span> <span class="o">=</span> <span class="n">cam_to_world_centered</span><span class="p">(</span><span class="n">kp_3d</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">rcams</span><span class="p">)</span>
    <span class="n">kp3d_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kp_3d</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## %matplotlib qt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>

<span class="n">img0</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">img1</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img_lists</span><span class="p">)):</span>
<span class="c1"># for i in range(3):</span>
    <span class="k">if</span> <span class="n">img0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">img0</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_ls</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">img0</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">img_ls</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        
    <span class="k">if</span> <span class="n">img1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">img1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">out_ls</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">img1</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">out_ls</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        
    <span class="n">ax2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">show_2d_pose</span><span class="p">(</span><span class="n">kp_ls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ax2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
    
    <span class="n">ax3</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">show_3d_pose</span><span class="p">(</span><span class="n">kp3d_ls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ax3</span><span class="p">)</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">1e-25</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;imgs/asd/bro</span><span class="si">{i}</span><span class="s1">.jpg&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imgs_path</span><span class="o">/</span><span class="s1">&#39;asd&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>PosixPath(&#39;imgs/asd&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

